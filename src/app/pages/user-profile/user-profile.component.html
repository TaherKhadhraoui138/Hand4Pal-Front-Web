<div class="profile-container">
    <div class="container">
        <div class="profile-header">
            <h1>My Profile</h1>
            <p>Manage your account settings and preferences</p>
        </div>

        <div class="profile-grid">
            <!-- Sidebar Navigation -->
            <div class="profile-sidebar">
                <div class="user-brief" *ngIf="currentUser">
                    <div class="avatar-lg">{{ currentUser.firstName?.charAt(0) }}{{ currentUser.lastName?.charAt(0) }}
                    </div>
                    <div class="user-info">
                        <h3>{{ currentUser.firstName }} {{ currentUser.lastName }}</h3>
                        <span>Member since {{ currentUser.createdAt | date:'yyyy' }}</span>
                    </div>
                </div>

                <nav class="profile-nav">
                    <a href="javascript:void(0)" class="nav-item" [class.active]="activeTab === 'personal'"
                        (click)="setActiveTab('personal')">
                        <span class="nav-icon">üë§</span> Personal Info
                    </a>
                    <a href="javascript:void(0)" class="nav-item" [class.active]="activeTab === 'donations'"
                        (click)="setActiveTab('donations')">
                        <span class="nav-icon">üíö</span> My Donations
                    </a>
                    <a href="javascript:void(0)" class="nav-item" [class.active]="activeTab === 'security'"
                        (click)="setActiveTab('security')">
                        <span class="nav-icon">üîí</span> Security
                    </a>
                    <a href="javascript:void(0)" class="nav-item text-danger" (click)="logout()">
                        <span class="nav-icon">üö™</span> Sign Out
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="profile-content">
                <!-- Alerts -->
                <div *ngIf="successMessage" class="alert alert-success">
                    {{ successMessage }}
                </div>
                <div *ngIf="errorMessage" class="alert alert-danger">
                    {{ errorMessage }}
                </div>

                <!-- Personal Info Tab -->
                <div class="card" *ngIf="activeTab === 'personal'">
                    <div class="card-header">
                        <h2>Personal Information</h2>
                    </div>

                    <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="profile-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" formControlName="firstName">
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" formControlName="lastName">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" formControlName="email">
                        </div>

                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" formControlName="phone">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" [disabled]="isLoading">Save Changes</button>
                        </div>
                    </form>
                </div>

                <!-- My Donations Tab -->
                <ng-container *ngIf="activeTab === 'donations'">
                    <ng-container *ngIf="{ 
                        donations: donations$ | async, 
                        isLoading: isLoadingDonations$ | async,
                        totalDonated: totalDonated$ | async 
                    } as state">
                        <div class="card">
                            <div class="card-header">
                                <h2>My Donations</h2>
                                <p class="header-subtitle" *ngIf="state.donations && state.donations.length > 0">
                                    Total donated: <strong>{{ formatCurrency(state.totalDonated || 0) }}</strong>
                                </p>
                            </div>

                            <!-- Loading State -->
                            <div class="donations-loading" *ngIf="state.isLoading">
                                <div class="spinner"></div>
                                <p>Loading your donations...</p>
                            </div>

                            <!-- Empty State -->
                            <div class="donations-empty" *ngIf="!state.isLoading && (!state.donations || state.donations.length === 0)">
                                <div class="empty-icon">üíö</div>
                                <h3>No donations yet</h3>
                                <p>You haven't made any donations yet. Start making a difference today!</p>
                                <a routerLink="/campaigns" class="btn btn-primary">Browse Campaigns</a>
                            </div>

                            <!-- Donations List -->
                            <div class="donations-list" *ngIf="!state.isLoading && state.donations && state.donations.length > 0">
                                <div class="donation-item" *ngFor="let donation of state.donations">
                                    <div class="donation-icon">
                                        üíö
                                    </div>
                                    <div class="donation-info">
                                        <h4 class="campaign-name">
                                            <a [routerLink]="['/campaigns', donation.campaignId]">
                                                {{ donation.campaign?.title || 'Campaign #' + donation.campaignId }}
                                            </a>
                                        </h4>
                                        <p class="donation-date">{{ donation.donationDate | date:'MMM d, yyyy \"at\" h:mm a' }}</p>
                                    </div>
                                    <div class="donation-amount">
                                        {{ formatCurrency(donation.amount, donation.currency) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </ng-container>

                <!-- Security Tab -->
                <div class="card" *ngIf="activeTab === 'security'">
                    <div class="card-header">
                        <h2>Security Settings</h2>
                    </div>

                    <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="profile-form">
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" formControlName="currentPassword">
                        </div>

                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" formControlName="newPassword">
                        </div>

                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" formControlName="confirmPassword">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" [disabled]="isLoading">Change
                                Password</button>
                        </div>
                    </form>

                    <!-- Danger Zone -->
                    <div class="danger-zone">
                        <div class="danger-zone-header">
                            <span class="danger-icon">‚ö†Ô∏è</span>
                            <h3>Danger Zone</h3>
                        </div>
                        <div class="danger-zone-content">
                            <div class="danger-zone-info">
                                <h4>Delete Account</h4>
                                <p>Once you delete your account, there is no going back. All your data will be permanently removed.</p>
                            </div>
                            <button type="button" class="btn btn-danger" (click)="onDeleteAccount()">
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>