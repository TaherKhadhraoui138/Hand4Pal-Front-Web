<ng-container *ngIf="{ isLoading: isLoading$ | async } as state">
<div class="modal-overlay" (click)="close()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Make a Donation</h2>
            <button class="close-btn" (click)="close()" [disabled]="state.isLoading">&times;</button>
        </div>

        <div class="modal-body">
            <div class="donation-details">
                <p class="campaign-title">Supporting: <strong>{{ campaignTitle }}</strong></p>

                <div class="amount-selection">
                    <label>Select Amount</label>
                    <div class="amount-grid">
                        <button class="amount-btn" [class.active]="selectedAmount === 10"
                            (click)="selectAmount(10)" [disabled]="state.isLoading">$10</button>
                        <button class="amount-btn" [class.active]="selectedAmount === 25"
                            (click)="selectAmount(25)" [disabled]="state.isLoading">$25</button>
                        <button class="amount-btn" [class.active]="selectedAmount === 50"
                            (click)="selectAmount(50)" [disabled]="state.isLoading">$50</button>
                        <button class="amount-btn" [class.active]="selectedAmount === 100"
                            (click)="selectAmount(100)" [disabled]="state.isLoading">$100</button>
                    </div>
                    <div class="custom-amount">
                        <span class="currency">$</span>
                        <input type="number" placeholder="Custom Amount" [(ngModel)]="customAmount"
                            (focus)="selectedAmount = 0" [disabled]="state.isLoading === true" min="1">
                    </div>
                </div>

                <div class="currency-selection">
                    <label>Currency</label>
                    <select [(ngModel)]="currency" [disabled]="state.isLoading === true">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (â‚¬)</option>
                        <option value="MAD">MAD (DH)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <div class="total">
                <span>Total Donation</span>
                <span class="amount">{{ getDisplayAmount() | currency:currency }}</span>
            </div>
            <button class="btn btn-primary btn-block btn-lg" 
                    (click)="submitDonation()" 
                    [disabled]="state.isLoading">
                <span *ngIf="!state.isLoading">Complete Donation</span>
                <span *ngIf="state.isLoading">Processing...</span>
            </button>
        </div>
    </div>
</div>
</ng-container>

<!-- Alert Modal -->
<app-alert-modal
    *ngIf="showAlert"
    [isOpen]="showAlert"
    [type]="alertType"
    [title]="alertTitle"
    [message]="alertMessage"
    (closed)="onAlertClose()">
</app-alert-modal>